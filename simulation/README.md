# README

This folder contains code to reproduce Figure 1-5 presented in **Section: Simulation**.

## Data Preparation
**SIM_THMS.R**  
- Simulate data using the generative model proposed in Section 2.2: Generation of the Longitudinal EHR Feature Occurrences.
- Calculate the empirical and low-rank PMI estimator and estimate their entry-wise standard deviation.
- Used in Figure 1 Middle and Right, Figure 5

**PMITable1_241230.R**
- Calculate the p-values under the global null hypothesis. (used to plot Figure 4)

**PMI_discourse_robust_T.R**
- Simulate data using different distribution for the discourse vectors.
- Calculate the Max norm distances between EHR entity embeddings and PMI estimators for each distribution (used to plot Figure 2)

## Figures

- **Figure 1**: Max norm distances between EHR entity embeddings and PMI estimators. Generated by `Fig1Left.Rmd` and `Figure1MiddleRight_and_Figure5.Rmd`
- **Figure 2**: Max norm distances between EHR entity embeddings and PMI estimators. Generated by `Figure2_4.ipynb`
- **Figure 3**: Relation between the max-norm difference and `n,T`. Generated by `Figure2_4.ipynb`
- **Figure 4**: Power Analysis. Comparison of our proposed method with and without patient-level data under the global null hypothesis. Generated by `Figure2_4.ipynb`
- **Figure 5**: Average half width of 95% confidence interval of the first ten entries respectively constructed by the empirical estimator and the low-rank estimator. Generated by `Figure1MiddleRight_and_Figure5.Rmd`
